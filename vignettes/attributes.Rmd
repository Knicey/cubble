---
title: "1. Cubble attributes"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{attribute}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
library(cubble)
library(dplyr)
```

On top of the attributes inherent from class, a cubble has its own attributes `leaves` and `form`. `leaves` records whether a variable is time-invariant or not while `form` specifies whether the data object is in the nested or long form. 

Here we print out the attributes for a nested cubble: 

```{r}
nested <- climate_flat %>% 
  tamp(station)
nested
attributes(nested)
```

A nested cubble is built from a rowwise tibble where the `rowwise_df` class uses a `group` attributes to ensure each row is in its own `group` attributes. With a rowwise structure, there is no need to use `map` when manipulating the list-column. Compare the two syntaxes below for computing the number of raining day:

```{r}
climate_flat %>% 
  tidyr::nest(c(date, prcp, tmax, tmin)) %>% 
  mutate(rain = purrr::map_dbl(data, ~sum(.x$prcp != 0, na.rm= TRUE)))

climate_flat %>%
  tamp(station) %>%  # cubble names the list-column as `ts` rather than `data`
  mutate(rain = sum(ts$prcp != 0, na.rm = TRUE))
```

The `leaves` attribute records the time-invariant variables and this ensures a cubble can be switch back to the nested form from the long form. `leaves` has further two attributes `invariant` and `variant` to record whether a variable varies with time or not.

```{r}
leaves(nested)
leaves(nested) %>% attributes()
```

A long form cubble is built, instead from a grouped tibble. This means rather than a `rowwise_df`, the long form has the class `grouped_df` and the `.rows` columns in the `groups` attribute changes to the time length recorded in each group.

```{r}
long <- nested %>% stretch()
long
attributes(long)
```
